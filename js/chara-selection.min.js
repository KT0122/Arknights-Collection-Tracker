let version="v.1.1.1",selected_server="cn",current_total_operator=0,current_total_operator_en=0,selected_count=0,total_chara_rarity=[0,0,0,0,0,0],total_chara_rarity_en=[0,0,0,0,0,0],chara_rarity_count=[0,0,0,0,0,0];function CreateCharaDiv(e){let t="";switch(e.class){case"Caster":t="caster.png";break;case"Defender":t="defender.png";break;case"Guard":t="guard.png";break;case"Medic":t="medic.png";break;case"Sniper":t="sniper.png";break;case"Specialist":t="specialist.png";break;case"Supporter":t="supporter.png";break;case"Vanguard":t="vanguard.png"}return`\n        <div class="col-lg-2 col-md-3 col-4 text-center">            \n            <button class="chara-img-btn" data-selected="false" data-id=${e.id} data-rarity=${e.rarity} data-server=${e.server}>\n                <div class="chara-img-box">\n                    <img class="chara-img disable-drag" src="${location.pathname}../img/ak/avatars/${e.image}.png" loading="lazy" width="128" height="128" alt="${e.name}">\n                    <img class="chara-img-class disable-drag" src="${location.pathname}../img/ak/classes/${t}">                \n                </div>\n            </button>\n        </div>\n    `}function SetChangelog(){$.getJSON(`${location.pathname}changelog.json`,function(e){e.changelog.reverse(),e.changelog.forEach(e=>{$(".changelog-body").append(`<b>Version ${e.version}</b>`),e.list.forEach(e=>{$(".changelog-body").append("<br>- "+e)}),$(".changelog-body").append("<br><br>")})})}function SetCharaDiv(){$.getJSON(`${location.pathname}chara-db.json`,function(e){e.chara.forEach(e=>{current_total_operator++,total_chara_rarity[e.rarity-1]++,2==e.server&&(current_total_operator_en++,total_chara_rarity_en[e.rarity-1]++),$(".chara-selection-"+e.rarity).append(CreateCharaDiv(e))})}).then(function(){$(".selected-server, .selected-server-2").append("CN"),$(".total-operator").append(current_total_operator),total_chara_rarity.forEach((e,t)=>{$("#rarity-"+(t+1)+"-total").html("/"+e)}),$(".chara-img-btn").click(function(){let e=$(this).data("selected"),t=$(this).data("rarity");!1===e?($(this).css("background","white"),$(this).data("selected",!0),selected_count++,chara_rarity_count[t-1]++,$("#rarity-"+t).html(chara_rarity_count[t-1]),$(".selected").html(selected_count)):($(this).css("background","rgba(0,0,0,0)"),$(this).data("selected",!1),selected_count--,chara_rarity_count[t-1]--,$("#rarity-"+t).html(chara_rarity_count[t-1]),$(".selected").html(selected_count))})})}function Reset(){selected_count=0,$(".selected").html(selected_count),chara_rarity_count=[0,0,0,0,0,0];for(let e=1;e<=chara_rarity_count.length;e++)$("#rarity-"+e).html(0);$("#rarity-"+$(this).data("rarity")).html(0),$(".chara-img-btn").each(function(){$(this).css("background","rgba(0,0,0,0)"),$(this).data("selected",!1)})}$(document).ready(function(){$(".version").append(version),$(".selected").html(selected_count),SetChangelog(),SetCharaDiv(),$("img").on("dragstart",function(e){e.preventDefault()}),$("#ign-input").keyup(function(){$("#ign").text("IGN : "+$(this).val())}),$("#server").click(function(){$(this).prop("checked")?(selected_server="en",$(".chara-img-btn[data-server=1]").parent().css("display","none"),$(".chara-img-btn[data-server=1]").data("selected",!1).css("background","rgba(0,0,0,0)"),$(".server-non-cn").css("display","flex"),$("#server-en").prop("checked",!0),$(".selected-server").html("EN/JP/KR"),$(".selected-server-2").html("EN"),$(".total-operator").html(current_total_operator_en),total_chara_rarity_en.forEach((e,t)=>{$("#rarity-"+(t+1)+"-total").html("/"+e)})):(selected_server="cn",$(".chara-img-btn[data-server=1]").parent().css("display","flex"),$(".server-non-cn").css("display","none"),$(".selected-server, .selected-server-2").html("CN"),$(".total-operator").html(current_total_operator),total_chara_rarity.forEach((e,t)=>{$("#rarity-"+(t+1)+"-total").html("/"+e)})),Reset()}),$(".server-radio").click(function(){let e=$(this).prop("id");"server-en"==e?$(".selected-server-2").html("EN"):"server-jp"==e?$(".selected-server-2").html("JP"):"server-kr"==e&&$(".selected-server-2").html("KR")}),$("#reset").click(function(){Reset()}),$("#select-all").click(function(){if($(".chara-img-btn").data("selected",!0).css("background","white"),"en"==selected_server){$(".selected").html(current_total_operator_en);for(let e=1;e<=chara_rarity_count.length;e++)chara_rarity_count[e-1]=total_chara_rarity_en[e-1],$("#rarity-"+e).html(chara_rarity_count[e-1])}else if("cn"==selected_server){$(".selected").html(current_total_operator);for(let e=1;e<=chara_rarity_count.length;e++)chara_rarity_count[e-1]=total_chara_rarity[e-1],$("#rarity-"+e).html(chara_rarity_count[e-1])}}),$("#to-top").click(function(){$("html, body").animate({scrollTop:$("body").offset().top},1e3)}),$("#download").click(function(){var e=document.createElement("a");e.href=$("canvas")[0].toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream"),e.download="ak-collection-generator.jpg",e.click()}),$("#generate").click(function(){$("#generate").css("display","none"),""===$("#ign-input").val()&&$("#ign").css("display","none"),$(".chara-img-btn").each(function(){!1===$(this).data("selected")?$(this).parent().css("display","none"):$(this).css("background","rgba(0,0,0,0)")});let e=[];chara_rarity_count.forEach((t,a)=>{t<=0&&$(".chara-selection-"+(a+1)).css("display","none"),e.push(a)}),$("html, body").animate({scrollTop:$("body").offset().top},0),html2canvas(document.querySelector("#capture-area"),{backgroundColor:"#1b262c",width:window.innerWidth}).then(t=>{let a=(new Date).format("Ymd-his"),r=t.toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream");$("#result-img").attr("src",r),$("#result-a").attr("href",r),""!==$("#ign-input").val()?$("#result-a").attr("download",`ak-collection-tracker-${$("#ign-input").val()}-${a}.jpg`):$("#result-a").attr("download",`ak-collection-tracker-${a}.jpg`),$("#generate").css("display","initial"),$(".capture-result").css("display","initial"),$("#ign").css("display","flex"),$(".chara-img-btn").each(function(){!1===$(this).data("selected")?$(this).parent().css("display","initial"):$(this).css("background","white")}),e.forEach(e=>{$(".chara-selection-"+e).css("display","flex")}),$("#server").prop("checked")?$(".chara-img-btn[data-server=1]").parent().css("display","none"):$(".chara-img-btn[data-server=1]").parent().css("display","flex"),$("html, body").animate({scrollTop:$("div.capture-result").offset().top},1e3)})})});